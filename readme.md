# 核心交易模型更新版

## 1. 交易模型的通用性
- 无论使用何种策略，其最终交易行为都可以归结为：
  1. **买入信号（Buy Signal）**
  2. **卖出信号（Sell Signal）**
  3. **基于 Candlestick（K线）的市场数据（OHLCV）**
- 模型的设计核心在于对上述三者的统一表示和处理，确保框架的通用性和灵活性。

---

## 2. 固定卖出规则与动态买入信号评估
- **移动止损：**
  - 动态调整止损位置（如基于 ATR 或百分比），适应市场波动。
  - 当止损触发卖出时，之前的每一天都视为潜在买入信号。
- **统计支持：**
  - 卖出触发点回溯所有潜在买入信号，评估其效益，为优化买入策略提供数据支持。

---

## 3. 仓位管理
### 分批下注策略
- **基础逻辑：**
  - 每次交易的最大下注金额固定为 **总资金的部分额度**（如 1000 总资金，每次最大下注额 100）。
  - 具体下注额度通过 **贝叶斯概率 + 凯利公式** 动态调整。

### 贝叶斯+凯利动态调整
- **计算方法：**
  1. **贝叶斯概率：**
     - 利用信号的历史胜率进行更新。
     - 基于最新的 **x 笔数据（moving window）** 重新估算信号获胜概率 \( p \)：
       \[
       P(\text{Win | Data}) = \frac{P(\text{Data | Win}) \cdot P(\text{Win})}{P(\text{Data})}
       \]
  2. **凯利公式：**
     - 根据贝叶斯概率计算最优下注比例：
       \[
       f^* = p - \frac{1 - p}{r}
       \]
       - \( p \)：信号的胜率（贝叶斯更新后）。
       - \( r \)：风险回报比。
       - \( f^* \)：最优下注占单次最大额度的比例。
     - 实际下注金额为：
       \[
       \text{下注金额} = f^* \times \text{最大下注额度（如 100）}
       \]

### 动态适应
- **优势：**
  - 高胜率信号下，逐步增加仓位，捕捉更多收益。
  - 低胜率信号时减少下注金额，降低风险暴露。

---

## 4. 回测与实盘一致性
- **无缝衔接：**
  - 回测与实盘交易逻辑一致，信号生成、仓位管理、交易执行完全统一。
  - 回测阶段生成的信号和数据，可直接用于实盘，无需额外调整。
- **动态适应：**
  - 实盘交易中实时处理最新数据，通过移动窗口更新信号胜率和下注额度。

---

## 5. 模型特点
- **统一性：** 所有策略都以买入信号的形式纳入框架。
- **灵活性：**
  - 固定卖出规则简化评估。
  - 分批下注结合动态调整，适应不同信号强弱。
- **鲁棒性：** 移动窗口贝叶斯概率更新和分批下注策略增强模型稳定性，避免单次信号失误对资金的重大影响。

---

## 总结
通过 **移动止损规则**、**贝叶斯概率结合凯利公式的动态分批下注** 设计，交易模型实现以下优化：
1. **提高卖出灵活性：** 动态止损与信号回溯为优化买入信号提供了坚实的数据基础。
2. **增强仓位管理：** 分批下注避免过度暴露，结合凯利公式在高胜率时放大收益。
3. **适应性强：** 利用移动窗口实时更新，提高策略对市场变化的敏感度和应对能力。

这一设计在保证回测与实盘一致性的同时，显著提升了策略的灵活性与风险管理能力。
